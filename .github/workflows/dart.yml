name: ğŸ‰ iOS-ipa-build

on:
  workflow_dispatch: 

jobs:
  build-ios:
    name: ğŸ‰ iOS Build
    runs-on: macos-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          channel: 'stable'
          architecture: arm64 

      - name: 1. Deep Clean & Pub Get
        run: |
          flutter clean
          flutter pub get

      - name: 2. Force Create Ephemeral Files
        # Ù‡Ø°Ù‡ Ø§Ù„Ø®Ø·ÙˆØ© ØªØ®Ø¯Ø¹ Xcode Ùˆ CocoaPods Ø¨Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„ÙØ§Øª ÙˆÙ‡Ù…ÙŠØ© Ù…Ø¤Ù‚ØªØ§Ù‹
        run: |
          mkdir -p ios/Flutter
          touch ios/Flutter/podhelper.rb
          touch ios/Flutter/Generated.xcconfig
          # Ø§Ù„Ø¢Ù† Flutter Ø³ÙŠÙ‚ÙˆÙ… Ø¨ØªØ­Ø¯ÙŠØ« Ù‡Ø°Ù‡ Ø§Ù„Ù…Ù„ÙØ§Øª Ø¯ÙˆÙ† Ø£Ù† ÙŠÙ†Ù‡Ø§Ø± Ø¨Ø³Ø¨Ø¨ Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯Ù‡Ø§
          flutter build ios --config-only --release --no-codesign

      - name: 3. Install CocoaPods
        run: |
          cd ios
          # Ø­Ø°Ù Ø£ÙŠ Ù…Ù„Ù Ù‚ÙÙ„ Ù‚Ø¯ÙŠÙ… ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ«Ø¨ÙŠØª Ù…Ù† Ø§Ù„ØµÙØ±
          rm -f Podfile.lock
          pod install --repo-update
          cd ..

      - name: 4. Final Build
        run: flutter build ios --release --no-codesign

      - name: 5. Create IPA
        run: |
          cd build/ios/iphoneos
          mkdir Payload
          cp -r Runner.app Payload/
          zip -qq -r -9 FlutterIpaExport.ipa Payload
          
      - name: 6. Upload to Release
        uses: svenstaro/upload-release-action@v2
        with:
          repo_token: ${{ secrets.GITHUB_TOKEN }}
          file: build/ios/iphoneos/FlutterIpaExport.ipa
          tag: v1.0.5
          overwrite: true
          body: "ØªÙ… Ø¥ØµÙ„Ø§Ø­ Ø®Ø·Ø£ podhelper.rb Ø¨Ù†Ø¬Ø§Ø­."
